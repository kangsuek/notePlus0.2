# notePlus - Product Requirements Document (PRD)

## 1. 프로젝트 개요

**제품명**: notePlus
**설명**: 마크다운 메모 + 계산기 macOS 앱

**핵심 가치**: macOS 사용자가 마크다운 문법으로 메모를 작성하면서 동시에 수식 계산을 할 수 있는 네이티브 앱

### 핵심 기능

1. **마크다운 편집**: 실시간 프리뷰, 모든 마크다운 문법 지원
2. **수식 계산**: `=` 입력 시 즉시 계산 결과 표시 (mathjs 사용)
3. **양방향 스크롤 동기화**: Editor ↔ Preview 간 스크롤 동기화 (무한 루프 방지)
4. **파일 관리**: 로컬 파일 저장/열기, 최근 문서 관리, 드래그 앤 드롭 지원
5. **macOS 네이티브**: Dark Mode, 키보드 단축키, 메뉴바 시스템
6. **다중 파일 포맷**: .md, .txt, .pdf 지원

**타겟 사용자**: 메모와 계산을 동시에 필요로 하는 macOS 사용자 (개발자, 연구자, 학생)

**개발 방법론**: TDD (Test-Driven Development) 기반 애자일 개발

---

## 2. 기술 스택

**플랫폼**: macOS 11.0+

**핵심 기술**:

- Electron + React + TypeScript
- Vite (빌드 도구)
- Jest + React Testing Library (테스트)
- electron-builder (패키징)

**주요 라이브러리**:

- `marked`: 마크다운 파싱
- `mathjs`: 안전한 수식 계산
- `electron-store`: 로컬 스토리지
- Styled Components: UI 스타일링

**보안 원칙**:

- Electron 보안 모델 준수 (nodeIntegration: false, contextIsolation: true)
- CSP (Content Security Policy) 적용
- mathjs를 통한 안전한 수식 계산 (eval 금지)

---

## 3. 개발 가이드

**TDD 원칙**:

- 모든 기능 개발 시 테스트부터 작성
- 테스트 실패 → 구현 → 테스트 통과 → 리팩토링 순서 준수

**코드 품질**:

- 단일 책임 원칙 (함수는 하나의 역할만)
- Prettier + ESLint 코드 스타일 유지
- 읽기 쉬운 코드로 의도 표현 (최소한의 주석)

**테스트 정책**:

- 유닛 테스트 + 통합 테스트 필수
- 모든 테스트 통과 후 배포
- 목표 테스트 커버리지: 70% 이상

---

## 4. UI/UX 설계

**디자인 원칙**:

- macOS Human Interface Guidelines 준수
- Dark Mode / Light Mode 지원
- 반응형 레이아웃

**화면 구성**:

- **Sidebar**: 최근 문서 목록 (접기/펼치기 가능)
- **Editor**: 마크다운 편집기 (라인 넘버 표시)
- **Preview**: 실시간 HTML 프리뷰
- **StatusBar**: 커서 위치, 파일 인코딩, 저장 상태
- **MenuBar**: File, Edit, View, Window, Help

**프로그램 UI** (현재 구현 완료):

```
┌───────────────────────────────────────────────────────────────────────┐
│ 🔴🟠🟢              notePlus                    🌙 라이트 모드         │ ← TitleBar (52px)
├──────────────────────┬────────────────────────┬───────────────────────┤
│ untitled.md *        │ Editor                 │ Preview               │ ← 헤더 (48px 통일)
│ (클릭하여 편집)       │                        │                       │    * 수정 시 표시
├──────────────────────┼────────────────────────┼───────────────────────┤
│▼ 최근 문서 (0) 🔄 🗑️  │ ┌──┬──────────────────┤                       │
│                      │ │1 │ # notePlus       │   notePlus            │
│  최근 문서가          │ │2 │                  │                       │
│  없습니다 ← 파일 목록   │ │3 │ 마크다운으로        │   마크다운 메모      │
│                      │ │4 │ 작성하세요...      │   + 계산기           │
│                      │ │5 │                  │                       │
│                      │ │..│                  │                       │
│                      │ │  │ ← 스크롤 동기화     │                       │
│                      │ │50│                  │                       │
│                      │ │  │                  │                       │
│                      │ └──┴──────────────────┤                       │
│                      │    ↑ 줄번호 배경        │                       │
│                      │      전체 높이          │                       │
├──────────────────────┴────────────────────────┴───────────────────────┤
│ 줄 3, 칸 1                                     수정됨 UTF-8           │ ← StatusBar
│ ↑ 실시간 업데이트                               ↑ 3초간 표시 후 자동 숨김  │
└───────────────────────────────────────────────────────────────────────┘
```

**구현할 주요 기능**:

- **파일명 inline 편집**: Sidebar 상단 파일명 클릭 시 편집 가능 (Enter/Escape 지원)
- **수정 상태 표시**: 파일명 뒤 `*` 표시, StatusBar에 "수정됨" 3초간 표시
- **커서 위치 실시간 추적**: Editor 커서 이동 시 StatusBar에 줄/칸 즉시 반영
- **스크롤 동기화**: Editor 스크롤 시 줄번호 동시 스크롤
- **줄번호 전체 높이**: 줄번호 배경색이 Editor 전체 높이 차지
- **테마 토글**: TitleBar 오른쪽에 아이콘 + 텍스트 ("라이트 모드"/"다크 모드")
- **헤더 높이 통일**: 파일명/최근문서/Editor/Preview 헤더 모두 48px
- **자동 줄바꿈시 줄번호 붙이기에 요구되는 동작**:
  1. 논리적 줄 (Enter 키로 생성된 실제 줄): 줄번호 표시 ✅
  2. 자동 줄바꿈된 시각적 줄: 줄번호 없이 빈칸 ⬜
     예시)
  ```
    1  첫 번째 줄입니다
    2  이것은 매우 긴 텍스트로 에디터 폭을 초과하여 자동으로 줄바꿈되는 내용입니다
       ← 이 부분은 자동 줄바꿈된 시각적 줄이므로 줄번호 없이 빈칸
    3  세 번째 실제 줄입니다
  ```

**주요 인터랙션**:

- 실시간 마크다운 프리뷰
- `=` 입력 시 즉시 계산 결과 표시
- Editor ↔ Preview 양방향 스크롤 동기화
- 드래그 앤 드롭 파일 열기
- ResizablePane으로 영역 크기 조절

### 4.1 스크롤 동기화 상세 요구사항

**목표**: Editor와 Preview 간 부드럽고 정확한 스크롤 동기화

**핵심 요구사항**:

1. **양방향 동기화**
   - Editor 스크롤 → Preview 자동 스크롤
   - Preview 스크롤 → Editor 자동 스크롤
   - 줄번호 영역도 Editor와 함께 스크롤

2. **스크롤 비율 기반 동기화**

   ```
   스크롤 비율 = 현재 스크롤 위치 / 최대 스크롤 가능 높이
   목표 스크롤 위치 = 스크롤 비율 × 목표 영역의 최대 스크롤 높이
   ```

3. **경계 케이스 처리**
   - **맨 위**: `scrollTop <= 1px` → 상대방도 정확히 `scrollTop = 0`
   - **맨 아래**: `scrollTop >= maxScroll - 1px` → 상대방도 정확히 맨 아래
   - **중간**: 스크롤 비율 계산 (0~1 범위로 clamp)
   - 목적: 맨 위/맨 아래에서 내용이 잘리지 않도록 보장

4. **무한 루프 방지**
   - Editor 스크롤 시 Preview 핸들러 일시 차단 (플래그)
   - Preview 스크롤 시 Editor 핸들러 일시 차단 (플래그)
   - 100ms 후 플래그 자동 리셋

5. **성능 최적화**
   - `requestAnimationFrame` 기반 throttle 사용
   - 스크롤 이벤트를 프레임 단위로 처리하여 부드러운 UX
   - 불필요한 리렌더링 방지

6. **정확도 보장**
   - 부동소수점 오차 방지: `Math.round()` 사용
   - 스크롤 비율을 0~1 범위로 clamp: `Math.min(1, Math.max(0, ratio))`
   - 1px 허용 오차로 경계 케이스 안정적 처리

**구현 원칙**:

- 간단하고 안정적인 비율 기반 방식 사용
- 모든 문서 길이와 뷰포트 크기에서 일관되게 작동
- 사용자 경험 우선: 부드럽고 예측 가능한 스크롤

---

## 5. 성능 목표

- 앱 시작 시간: 3초 이내
- 메모리 사용량: 100MB 이하
- 테스트 커버리지: 70% 이상

---

## 6. 개발 로드맵

### Phase 1 (MVP) - 완료

- 마크다운 편집 + 실시간 프리뷰
- 수식 계산 기능
- 기본 파일 관리

### Phase 2 (macOS 네이티브) - 진행 중

- 키보드 단축키
- 스크롤 동기화
- 파일 시스템 연동
- 메뉴바 시스템

### Phase 3 (고급 기능)

- 검색 기능
- 내보내기 (PDF, HTML)
- 구문 강조

### Phase 4 (확장)

- 클라우드 동기화
- 플러그인 시스템

---

개발을 시작합니다. @02.progress-status.md 파일의 세부 단계(1.1, 1.2 등)별로 순차적으로 개발을 진행해주세요.

**개발 방식:**

- 각 세부 단계마다 subagent에게 명확한 개발 지시를 전달
- subagent가 해당 단계의 구현을 완료하도록 지원
- 각 단계 완료 후 @02.progress-status.md 파일의 진행 상태를 업데이트
- 다음 단계 시작 전에 반드시 진행 여부를 확인 요청

**진행 프로세스:**

1. 현재 단계의 요구사항 확인
2. subagent에게 구체적인 구현 지시
3. 구현 완료 확인 및 검증
4. progress-status.md 업데이트
5. 다음 단계 진행 여부 확인

각 단계가 완료되면 "다음 단계 [X.X]를 진행할까요?"라고 물어봐주세요.
